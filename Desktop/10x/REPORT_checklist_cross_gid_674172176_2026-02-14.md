# Parity Report: `checklist_cross` (gid=674172176) vs Autonomous Backend

Дата: 2026-02-14  
Проект: `C:\Users\alien\Desktop\10x`  
Golden: `tmp_gid_674172176.csv`  
Diff harness: `backend_compat/checklist_cross_diff.py`  
Latest report: `backend_compat/data/checklist_cross_autonomous_diff_report_20260214T174457Z.json`

## Что сравнивали

Лист `checklist_cross` (19 ключей по каждому `nm_id` и дате) сравнивался с результатом автономной сборки `handle_checklist()` в `backend_compat/datasets.py`.

Период: `2025-11-01` .. `2026-02-13`  
`nm_id`: 40  
Ключей: 19  
Всего числовых ячеек: 79,800

## Метрика

`numeric_exact_ratio` = доля числовых ячеек, где автономное значение совпало с листом в пределах допуска:

- `abs(a - s) <= max(abs(s) * 0.01, 0.01)`

То есть допускается 1% относительной ошибки (или 0.01 абсолютной для малых значений).

## Итог (последний прогон)

- `numeric_exact_ratio`: **0.778283** (77.83%)
- `numeric_mae`: **124.835734**
- `numeric_mape`: **10.576485%**
- `missing_value_ratio`: **0.0** (структурных пропусков нет)

## Разрез по ключам (хуже -> лучше)

| key | exact | MAE | MAPE |
|---|---:|---:|---:|
| stocks_total | 0.577619 | 70.546078 | 0.996749 |
| stocks_enough_for_with_buyout_perc | 0.621905 | 20.074338 | 0.989932 |
| profit_with_adv | 0.622381 | 285.421802 | 34.561428 |
| avg_price_with_spp | 0.625238 | 512.267669 | 0.380594 |
| expected_buyouts_dyn | 0.652381 | 0.319081 | 0.108908 |
| stocks | 0.666667 | 66.072143 | 1.004764 |
| adv_sum | 0.695238 | 49.316090 | 83.122797 |
| stocks_enough_for | 0.698095 | 15.503281 | 1.007408 |
| orders_count_local | 0.715952 | 1.997143 | 1.000000 |
| profit_without_adv | 0.758571 | 258.827383 | 0.320106 |
| expected_buyouts_sum_rub | 0.782857 | 835.446850 | 0.155065 |
| spp | 0.788095 | 0.012314 | 0.075441 |
| orders_dyn | 0.838571 | 0.240146 | 0.059829 |
| orders_sum_rub | 0.913095 | 247.997321 | 0.036008 |
| orders_count | 0.913333 | 0.135476 | 0.035948 |
| adv_percent | 0.922143 | 0.005641 | 76.707739 |
| buyouts_count | 0.997619 | 0.006190 | 0.001202 |
| buyouts_sum_rub | 0.997619 | 7.689990 | 0.001189 |
| wrn_count | 1.000000 | 0.000000 | 0.000000 |

## Ключевые причины расхождений (кратко)

- `stocks_total`, `stocks_enough_for_with_buyout_perc`: зависит от корректной дневной семантики остатков + `buyout_percent_month` (который влияет на планируемые возвраты/выкупы).
- `adv_sum`: нужна точная дневная атрибуция рекламных расходов по SKU и типам кампаний; сейчас часть расходов распределяется эвристиками.
- `avg_price_with_spp`: требуется воспроизвести логику источника/переноса цены, которая в оригинале не всегда равна `orders_sum_rub / orders_count`.
- `profit_*`: зависит от unit-коэффициентов (комиссии/налоги/логистика/хранение) и правил распределения, которые сейчас не полностью совпадают с оригиналом.

